<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <!-- Package Sources Configuration -->
  <packageSources>
    <clear />
    <!-- Official NuGet.org feed -->
    <add key="nuget.org" value="https://api.nuget.org/v3/index.json" protocolVersion="3" />

    <!-- Microsoft package feeds for .NET 9 and newer packages -->
    <add key="dotnet9" value="https://pkgs.dev.azure.com/dnceng/public/_packaging/dotnet9/nuget/v3/index.json" protocolVersion="3" />

    <!-- Preview packages (disabled by default) -->
    <add key="dotnet-preview" value="https://pkgs.dev.azure.com/dnceng/public/_packaging/dotnet9-preview/nuget/v3/index.json" protocolVersion="3" />
  </packageSources>

  <!-- Package Source Mapping for security and performance -->
  <packageSourceMapping>
    <!-- Map Microsoft packages to appropriate feeds -->
    <packageSource key="nuget.org">
      <package pattern="*" />
    </packageSource>

    <packageSource key="dotnet9">
      <package pattern="Microsoft.*" />
      <package pattern="System.*" />
      <package pattern="runtime.*" />
    </packageSource>

    <packageSource key="dotnet-preview">
      <package pattern="Microsoft.*" />
      <package pattern="System.*" />
      <package pattern="runtime.*" />
    </packageSource>
  </packageSourceMapping>

  <!-- Disabled Package Sources (for conditional enabling) -->
  <disabledPackageSources>
    <!-- Disable preview feeds by default for stability -->
    <add key="dotnet-preview" value="true" />
  </disabledPackageSources>

  <!-- Package Management Settings -->
  <config>
    <!-- Global packages folder (uses default %userprofile%\.nuget\packages) -->
    <add key="globalPackagesFolder" value="" />

    <!-- Repository path for solution-level packages.config (not applicable for PackageReference) -->
    <add key="repositoryPath" value="packages" />

    <!-- Dependency resolution behavior -->
    <add key="dependencyVersion" value="Highest" />

    <!-- Default push source -->
    <add key="defaultPushSource" value="https://api.nuget.org/v3/index.json" />

    <!-- HTTP timeout for package operations (30 seconds) -->
    <add key="http_proxy.timeout" value="30000" />

    <!-- Maximum HTTP requests for parallel operations -->
    <add key="http_proxy.max_connections" value="5" />

    <!-- Trust unsigned packages for local development (be cautious) -->
    <add key="signatureValidationMode" value="require" />

    <!-- Package verification settings -->
    <add key="verifySignatures" value="true" />

    <!-- Auto package restore -->
    <add key="automatic-package-restore" value="true" />
  </config>

  <!-- Credential Providers (for private feeds) -->
  <packageSourceCredentials>
    <!-- Example private feed credentials (use environment variables or credential providers) -->
    <!--
    <MyPrivateFeed>
      <add key="Username" value="%NUGET_USERNAME%" />
      <add key="ClearTextPassword" value="%NUGET_PASSWORD%" />
    </MyPrivateFeed>
    -->
  </packageSourceCredentials>

  <!-- Trusted Signers for package security -->
  <trustedSigners>
    <!-- Trust Microsoft packages -->
    <author name="Microsoft">
      <certificate fingerprint="3F9001EA83C560D712C24CF213C3D312CB3BFF51EE89435D3430BD06B5D0EECE"
                   hashAlgorithm="SHA256"
                   allowUntrustedRoot="false" />
    </author>

    <!-- Trust NuGet.org repository -->
    <repository name="nuget.org" serviceIndex="https://api.nuget.org/v3/index.json">
      <certificate fingerprint="0E5F38F57DC1BCC806D8494F4F90FBCEDD988B46760709CBEEC6F4219AA6157D"
                   hashAlgorithm="SHA256"
                   allowUntrustedRoot="false" />
    </repository>
  </trustedSigners>

  <!-- Solution-specific settings -->
  <solution>
    <!-- Disable package restore for specific packages if needed -->
    <!--
    <add key="disableSourceControlIntegration" value="true" />
    -->
  </solution>

  <!-- Feed fallback settings -->
  <fallbackPackageFolders>
    <!-- Local fallback folders for offline development -->
    <!-- <add key="Local Packages" value="C:\LocalPackages" /> -->
  </fallbackPackageFolders>

  <!-- Binding redirects (for packages.config projects) -->
  <bindingRedirects>
    <add key="skip" value="False" />
  </bindingRedirects>
</configuration>